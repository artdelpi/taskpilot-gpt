<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<div class="sidebar">
  <div>
    <h4><i class="bi bi-rocket-takeoff-fill me-2"></i>Taskpilot</h4>

    <button id="openProfileModal"><i class="bi bi-person-circle"></i> Profile</button>
    <button id="openProjectsModal"><i class="bi bi-kanban"></i> Projects</button>
    <button id="openTasksModal"><i class="bi bi-check2-square"></i> Tasks</button>
    <button id="openTagsModal"><i class="bi bi-tag"></i> Tags</button>
    <button id="openSettingsModal"><i class="bi bi-gear"></i> Settings</button>
  </div>

  <div>
    <%= link_to destroy_user_session_path, method: :delete, data: { confirm: "Are you sure you want to log out?" }, class: "text-white d-flex align-items-center" do %>
     <i class="bi bi-box-arrow-right me-2"></i> Logout
    <% end %>
    <small class="d-block mt-2">Logged in as<br><strong><%= current_user.name || current_user.email %></strong></small>
  </div>
</div>

<div>
    <%= link_to destroy_user_session_path, method: :delete, data: { confirm: "Are you sure you want to log out?" }, class: "text-white d-flex align-items-center" do %>
      <i class="bi bi-box-arrow-right me-2"></i> Logout
    <% end %>

    <small class="d-block mt-2">
      Logged in as<br>
      <strong><%= current_user.name || current_user.email %></strong>
    </small>
  </div>
</div>

<div class="main-content">
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h2 class="fw-bold mb-1 text-primary">Your Projects</h2>
      <p class="text-muted mb-0">Ready to take off?</p>
    </div>
    <button id="openNewProjectModal" class="btn btn-primary btn-sm shadow-sm">New Project</button>
  </div>

  <% if current_user.projects.any? %>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <% current_user.projects.each do |project| %>
        <div class="col">
          <%= link_to project_path(project), class: "text-decoration-none text-dark" do %>
            <div class="card project-card p-3 h-100">
              <div class="card-body">
                <h5 class="card-title"><%= project.name %></h5>
                <p class="card-text text-muted"><%= truncate(project.description, length: 100) %></p>
              </div>
              <div class="card-footer text-muted small text-end bg-transparent border-0">
                <%= time_ago_in_words(project.created_at) %> ago
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="alert alert-info text-center">
      You haven't joined or created any projects yet.
    </div>
  <% end %>
</div>

<div id="settingsModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h4 class="mb-4 text-primary text-center fw-bold">
      <i class="bi bi-gear me-2"></i>Settings
    </h4>

    <form>
      <div class="mb-3">
        <label for="user_name" class="form-label">Your Name</label>
        <input type="text" class="form-control" id="user_name" placeholder="Change your display name">
      </div>

      <div class="mb-3">
        <label for="user_email" class="form-label">Email</label>
        <input type="email" class="form-control" id="user_email" placeholder="you@example.com">
      </div>

      <div class="d-flex justify-content-between">
        <button type="button" id="closeSettingsModal" class="btn btn-outline-secondary">Close</button>
        <%= button_to "Delete Account", registration_path(current_user), method: :delete, data: { confirm: "Are you sure you want to delete your account? This action is irreversible." }, class: "btn btn-outline-danger" %>
      </div>
    </form>
  </div>
</div>

<div id="newProjectModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h4 class="mb-4 text-primary text-center fw-bold">
      <i class="bi bi-kanban me-2"></i>Create a New Project
    </h4>

    <%= form_with(model: Project.new, url: projects_path, local: true) do |f| %>
      <div class="mb-3">
        <%= f.label :name, class: "form-label" %>
        <%= f.text_field :name, class: "form-control", placeholder: "Project name" %>
      </div>

      <div class="mb-3">
        <%= f.label :description, class: "form-label" %>
        <%= f.text_area :description, class: "form-control", placeholder: "Short description", rows: 4 %>
      </div>

      <div class="d-flex justify-content-between">
        <button type="button" id="closeNewProjectModal" class="btn btn-outline-secondary">Cancel</button>
        <%= f.submit "Create Project", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>

<div id="profileModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h4 class="mb-4 text-primary text-center fw-bold">
      <i class="bi bi-person-circle me-2"></i>User Profile
    </h4>

    <ul class="list-group mb-4">
      <li class="list-group-item d-flex justify-content-between">
        <strong>Name:</strong>
        <span><%= current_user.name.presence || "Not provided" %></span>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <strong>Email:</strong>
        <span><%= current_user.email %></span>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <strong>Created at:</strong>
        <span><%= current_user.created_at.strftime("%B %d, %Y") %></span>
      </li>
    </ul>

    <div class="d-flex justify-content-between">
      <%= link_to "Change Password", edit_user_registration_path, class: "btn btn-outline-primary" %>
      <button type="button" id="closeProfileModal" class="btn btn-secondary">Close</button>
    </div>
  </div>
</div>

<div id="projectsModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h4 class="mb-4 text-primary text-center fw-bold">
      <i class="bi bi-kanban me-2"></i>Your Projects
    </h4>

    <p class="text-muted">Manage or explore your projects here.</p>

    <div class="d-flex justify-content-end">
      <button type="button" id="closeProjectsModal" class="btn btn-secondary">Close</button>
    </div>
  </div>
</div>

<div id="tasksModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h4 class="mb-4 text-primary text-center fw-bold">
      <i class="bi bi-check2-square me-2"></i>Your Tasks
    </h4>

    <p class="text-muted">Review your current tasks and check your progress.</p>

    <div class="d-flex justify-content-end">
      <button type="button" id="closeTasksModal" class="btn btn-secondary">Close</button>
    </div>
  </div>
</div>

<div id="tagsModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h4 class="mb-4 text-primary text-center fw-bold">
      <i class="bi bi-tag me-2"></i>Your Tags
    </h4>

    <p class="text-muted">Organize and filter your tasks with tags.</p>

    <div class="d-flex justify-content-end">
      <button type="button" id="closeTagsModal" class="btn btn-secondary">Close</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const modals = [
      { open: "openProfileModal", modal: "profileModal", close: "closeProfileModal" },
      { open: "openNewProjectModal", modal: "newProjectModal", close: "closeNewProjectModal" },
      { open: "openProjectsModal", modal: "projectsModal", close: "closeProjectsModal" },
      { open: "openTasksModal", modal: "tasksModal", close: "closeTasksModal" },
      { open: "openTagsModal", modal: "tagsModal", close: "closeTagsModal" },
      { open: "openSettingsModal", modal: "settingsModal", close: "closeSettingsModal" }
    ];

    modals.forEach(({ open, modal, close }) => {
      const openBtn = document.getElementById(open);
      const closeBtn = document.getElementById(close);
      const modalDiv = document.getElementById(modal);

      if (openBtn && modalDiv) {
        openBtn.addEventListener("click", () => {
          modalDiv.style.display = "flex";
          modalDiv.classList.add("show");
        });
      }

      if (closeBtn && modalDiv) {
        closeBtn.addEventListener("click", () => {
          modalDiv.classList.remove("show");
          setTimeout(() => (modalDiv.style.display = "none"), 300);
        });
      }
    });
  });
</script>
